# 베이스 이미지
FROM ubuntu:22.04

# 필수 패키지 및 최신 CMake 설치
RUN apt-get update && apt-get install -y \
    git \
    ninja-build \
    g++ \
    make \
    curl \
    zip \
    unzip \
    tar \
    libssl-dev \
    bzip2 \
    pkg-config \
    autoconf \
    automake \
    autoconf-archive \
    autotools-dev \
    libtool \
    python3-dev \
    python3-setuptools \
    python3-distutils \
    python3-pip \
    cmake && \
    rm -rf /var/lib/apt/lists/*

# Conan 설치
RUN pip3 install conan

# JunCore 프로젝트 복제
WORKDIR /app
RUN git clone https://github.com/dkdldjswkd/JunCore .

# Conan 의존성 설치
WORKDIR /app/JunCore
RUN conan profile detect
RUN conan install . --build=missing --output-folder=conan --generator=CMakeDeps
RUN rm CMakeUserPresets.json

RUN cmake --preset x64-release-linux
RUN cmake --build --preset x64-release-linux

# 빌드 후 실행 디렉토리로 이동
WORKDIR /app/JunCore/out/build/x64-release-linux/src/echo_server

# 실행 파일 실행
ENTRYPOINT ["./echo_server"]